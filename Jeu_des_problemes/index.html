<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6200ea">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#6200ea"/>
  <title>Jeu des Probl√®mes</title>
  <style>
    :root{
      --violet:#6200ea;
      --bg:#f7f7f7;
      --card:#ffffff;
      --text:#222;
      --outline:#d9d9d9;
      --green:#2ecc71;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      padding:20px;
      padding-left:calc(20px + env(safe-area-inset-left));
      padding-right:calc(20px + env(safe-area-inset-right));
      padding-top:calc(20px + env(safe-area-inset-top));
      padding-bottom:calc(20px + env(safe-area-inset-bottom));
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--text); text-align:center;
      -webkit-tap-highlight-color: transparent;
    }
    h1{margin:10px 0 20px}
    .hidden{display:none}
    .btn{
      display:inline-block;
      padding:14px 18px; margin:8px;
      font-size:18px; border:none; border-radius:12px; color:#fff;
      background:var(--violet); cursor:pointer;
      min-height:48px; touch-action:manipulation;
      box-shadow:0 6px 14px rgba(98,0,234,.18);
    }
    .btn:active{transform:scale(.98)}
    .btn:disabled{opacity:.5; cursor:not-allowed}
    .btn-outline{
      background:#fff; color:#333; border:2px solid var(--outline);
      box-shadow:none; min-height:48px;
    }
    .btn-outline.selected{
      border:3px solid var(--green);
      background:#e9f9ef;
      font-weight:700;
    }
    .card{
      background:var(--card); border-radius:16px; padding:16px; margin:14px auto;
      box-shadow:0 6px 20px rgba(0,0,0,.08); max-width:720px; text-align:center;
    }
    .question{font-size:22px; font-weight:600}
    .inputs{display:flex; flex-direction:column; gap:10px; align-items:center}
    .input{
      width:92%; max-width:560px; padding:14px; border-radius:12px;
      border:1px solid #ddd; font-size:16px; /* 16px = pas de zoom iOS */
      background:#fff;
    }
    .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
    .muted{opacity:.8; font-size:14px}
    .tag{display:inline-block; padding:6px 10px; border-radius:999px; background:#eee; font-size:14px}

    /* Grille de boutons pour les joueurs */
    .grid{
      display:grid; gap:10px; margin:12px auto;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      width:92%; max-width:560px;
    }

    /* Pi√®ce contr√¥l√©e par transform */
    .coinwrap {margin:12px auto; position:relative; z-index:1;}
    .coin{
      width:140px; height:140px; margin:0 auto; position:relative;
      transform-style:preserve-3d; perspective:1000px;
      transform: rotateY(0deg); /* 0deg = PILE visible */
    }
    .face{
      position:absolute; inset:0; border-radius:50%;
      display:flex; align-items:center; justify-content:center;
      font-size:28px; font-weight:800; color:#262200;
      backface-visibility:hidden; border:3px solid #c08a00;
      background: radial-gradient(circle at 30% 30%, #ffe08a, #f4c531 60%, #e2a400);
      box-shadow:
        inset 0 0 10px rgba(255,255,255,.6),
        inset 0 0 30px rgba(0,0,0,.2),
        0 10px 20px rgba(0,0,0,.15);
    }
    .back{
      transform:rotateY(180deg);
      background: radial-gradient(circle at 30% 30%, #ffd978, #ecb828 60%, #d89a00);
    }
    .header-small{font-weight:700; margin:4px 0 10px}

    /* Zone boutons apr√®s flip au-dessus de tout */
    #afterFlip{ position:relative; z-index:5; }

    /* Confettis (clics non bloquants) */
    .confetti{
      position:fixed; top:-10px; width:10px; height:14px; opacity:.95;
      z-index:9999; will-change: transform; pointer-events:none;
      animation: fall linear forwards;
    }
    @keyframes fall {
      to { transform: translateY(110vh) rotateZ(360deg) rotateX(180deg); opacity:1; }
    }
    .celebration{
      font-size:18px; margin-top:10px; font-weight:700; color:#1a7f37;
    }

    /* Mobile tweaks */
    @media (max-width:520px){
      body{padding:14px; padding-top:calc(14px + env(safe-area-inset-top));}
      .btn{width:100%; font-size:17px}
      .btn-outline{width:100%}
      .question{font-size:20px}
      .card{padding:14px}
    }
  </style>
</head>
<body>
  <h1>üé≤ Jeu des Probl√®mes</h1>

  <!-- === √âTAPE 0 : MENU JOUEURS === -->
  <section id="menu" class="card">
    <h2>Ajouter les joueurs</h2>
    <div id="playersContainer" class="inputs">
      <input class="input player-input" type="text" placeholder="Pr√©nom du joueur" />
      <input class="input player-input" type="text" placeholder="Pr√©nom du joueur" />
    </div>
    <div class="row">
      <button class="btn" onclick="addPlayerInput()">‚ûï Ajouter un joueur</button>
      <button class="btn" onclick="startGame()">Commencer</button>
    </div>
    <p class="muted">Astuce : 3+ joueurs rend le jeu plus fun üòâ</p>
  </section>

  <!-- === √âTAPE 1 : STARTER CHOISIT/√âCRIT LA QUESTION === -->
  <section id="starterPhase" class="card hidden">
    <div id="starterInfo" class="question"></div>

    <div id="questionChoice" class="inputs">
      <select id="questionSelect" class="input"></select>
      <div class="muted">‚Ä¶ou √©cris ta propre question :</div>
      <input id="customQuestion" class="input" type="text" placeholder="√âcris ta question ici" />
      <button class="btn" id="validateQuestionBtn" onclick="validateQuestion()">Valider la question</button>
    </div>

    <!-- M√™me √©cran apr√®s validation : on masque les champs et on affiche ce bloc -->
    <div id="passToViewer" class="hidden">
      <p class="question">‚úÖ Question enregistr√©e (elle est cach√©e).</p>
      <p>üëâ Donne le t√©l√©phone √† la personne √† qui tu veux <strong>montrer</strong> la question.</p>
      <button class="btn" onclick="viewerReceived()">Le t√©l√©phone est re√ßu</button>
    </div>
  </section>

  <!-- === √âTAPE 2 : LECTEUR VOIT LA QUESTION & CHOISIT LA CIBLE === -->
  <section id="viewerStage" class="card hidden">
    <div class="tag">Lecteur</div>
    <p id="questionForViewer" class="question"></p>
    <p>Choisis maintenant le <strong>joueur cible</strong> √† qui poser la question :</p>
    <div id="targetButtons" class="grid"></div>
    <button id="validateTargetBtn" class="btn hidden" onclick="confirmTarget()">Valider le joueur</button>
  </section>

  <!-- === √âTAPE 3 : PASSAGE AU JOUEUR CIBLE === -->
  <section id="passToTarget" class="card hidden">
    <p id="passMsg" class="question"></p>
    <button class="btn" onclick="targetReceived()">Le t√©l√©phone est re√ßu</button>
  </section>

  <!-- === √âTAPE 4 : JOUEUR CIBLE & PI√àCE === -->
  <section id="coinPhase" class="card hidden">
    <div class="tag">Joueur cible</div>
    <div id="coinHeader" class="header-small"></div>

    <div class="coinwrap">
      <div id="coin" class="coin">
        <div class="face front">PILE</div>
        <div class="face back">FACE</div>
      </div>
    </div>

    <div id="coinInfo" class="muted">Appuie pour lancer la pi√®ce.</div>
    <button id="flipBtn" class="btn" onclick="flipCoin()">üé≤ Lancer la pi√®ce</button>

    <div id="afterFlip" class="hidden">
      <div id="celebrationText" class="celebration hidden">üéâ PILE ! Tu peux voir la question.</div>
      <button id="revealBtn" class="btn hidden" onclick="revealToTarget()">üëÄ Voir la question</button>
      <button id="nextBtn" class="btn hidden" onclick="nextRound()">‚û°Ô∏è Question suivante</button>
    </div>

    <div id="questionForTarget" class="card hidden" style="margin-top:14px;">
      <div class="question" id="qTextTarget"></div>
    </div>
  </section>

  <script>
    // === √âTAT GLOBAL ===
    let players = [];
    let starter = null;
    let target = null;
    let selectedTarget = null;
    let currentQuestion = "";
    let coinRotation = 0;         // angle cumul√© en degr√©s
    let lastFlipWasPile = false;  // r√©sultat du lancer

    // 50 questions vari√©es (dr√¥les, malaisantes, difficiles)
    let availableQuestions = [
  // ‚Äî QUESTIONS INITIALES ‚Äî
  "Qui est le plus dr√¥le ?",
  "Qui est le plus beau ?",
  "Qui a le plus de style ?",
  "Qui chante le mieux au karaok√© ?",
  "Qui survivrait le plus longtemps sur une √Æle d√©serte ?",
  "Qui ferait le meilleur/la meilleure chef(fe) d‚Äô√©quipe ?",
  "Qui triche le plus aux jeux ?",
  "Qui serait en retard √† son propre mariage ?",
  "Qui oublierait son propre anniversaire ?",
  "Qui dirait ‚Äúje suis presque l√†‚Äù alors qu‚Äôil/elle n‚Äôest pas parti(e) ?",
  "Qui se vexe le plus vite ?",
  "Qui a les go√ªts musicaux les plus discutables ?",
  "Qui se perdrait avec un ‚Äúraccourci‚Äù ?",
  "Qui publierait le post le plus g√™nant par erreur ?",
  "Qui r√©pond aux messages le plus lentement ?",
  "Qui a la meilleure poker face ?",
  "Qui serait le/la plus susceptible de spoiler une s√©rie ?",
  "Qui ferait semblant de comprendre une discussion technique ?",
  "Qui a l‚Äôhumour le plus noir ?",
  "Qui oublierait de payer sa part sans s‚Äôen rendre compte ?",
  "Qui tomberait amoureux(se) le/la plus vite ?",
  "Qui garderait un secret pendant 10 ans ?",
  "Qui dirait une v√©rit√© qui f√¢che au pire moment ?",
  "Qui a le rire le plus contagieux ?",
  "Qui se met le plus souvent dans des situations embarrassantes ?",
  "Qui serait le/la plus √† l‚Äôaise pour animer un mariage ?",
  "Qui a l‚Äôego le plus fragile ?",
  "Qui ferait faillite en premier ?",
  "Qui aurait le plus de mal sans Internet pendant 24h ?",
  "Qui est le/la plus myst√©rieux(se) ?",
  "Qui ferait le/la meilleur(e) d√©tective ?",
  "Qui passerait le plus de temps devant le miroir ?",
  "Qui a le pire r√©veil (humeur du matin) ?",
  "Qui a le plus grand sens du sacrifice ?",
  "Qui prendrait la pire d√©cision sous pression ?",
  "Qui s‚Äô√©clipse d‚Äôune soir√©e sans dire au revoir ?",
  "Qui demanderait une remise pour tout et n‚Äôimporte quoi ?",
  "Qui arriverait beaucoup trop t√¥t √† une soir√©e ?",
  "Qui a la plus grande capacit√© √† pardonner ?",
  "Qui ferait la meilleure d√©claration d‚Äôamour ?",
  "Qui serait un/une bon(ne) espion(ne) ?",
  "Qui a l‚Äôesprit le plus comp√©titif ?",
  "Qui ferait semblant d‚Äô√™tre malade pour √©viter une sortie ?",
  "Qui a le ‚Äúcrush‚Äù le plus improbable ici ?",
  "Qui est le/la plus t√™tu(e) ?",
  "Qui cuisinerait le plat le plus catastrophique ?",
  "Qui se lancerait dans un projet sans lire la notice ?",
  "Qui est le/la plus susceptible d‚Äôoublier o√π il/elle a gar√© ?",
  "Qui dirait ‚Äúj‚Äôai raison‚Äù m√™me en ayant tort ?",
  "Qui raconterait l‚Äôhistoire la plus honteuse sur soi sans h√©siter ?",

  // ‚Äî QUESTIONS G√äNANTES / SPICY üò≥ ‚Äî
  "Qui ici a probablement d√©j√† fouill√© le t√©l√©phone de son/sa partenaire ?",
  "Qui serait capable de rester avec quelqu‚Äôun juste pour ne pas √™tre seul(e) ?",
  "Qui ici a d√©j√† invent√© une excuse bidon pour ne pas revoir quelqu‚Äôun apr√®s un date ?",
  "Qui a d√©j√† pleur√© apr√®s avoir couch√© avec quelqu‚Äôun ?",
  "Qui ferait le plus probablement un sex-tape volontairement ?",
  "Qui ici a d√©j√† stalk√© un ex pendant plus d‚Äôun an ?",
  "Qui a probablement d√©j√† envoy√© un message √† la mauvaise personne en parlant d‚Äôelle ?",
  "Qui serait le plus probable de finir dans une relation toxique ?",
  "Qui couche avec quelqu‚Äôun sans forc√©ment le/la trouver attirant(e) ?",
  "Qui est le plus susceptible de dire ‚Äòje t‚Äôaime‚Äô juste pour coucher ?",
  "Qui est le plus probable d‚Äôavoir d√©j√† googl√© 'comment embrasser' ?",
  "Qui se masturbe le plus souvent ?",
  "Qui a d√©j√† pens√© √† quelqu‚Äôun autour de la table en se masturbant ?",
  "Qui a d√©j√† couch√© dans un lieu public ?",
  "Qui mentirait le plus facilement sur son nombre de partenaires ?",
  "Qui a le plus gros complexe physique ici ?",
  "Qui fait semblant d‚Äô√™tre plus intelligent(e) qu‚Äôil/elle ne l‚Äôest vraiment ?",
  "Qui a d√©j√† espionn√© un(e) ex IRL ou en ligne ?",
  "Qui n‚Äôassume clairement pas ses go√ªts (s√©rie, musique, crushs) ?",
  "Qui serait capable d‚Äôavoir une double vie sans que personne ne le sache ?",
  "Qui ici est probablement encore amoureux(se) de son ex ?",
  "Qui pourrait tromper son/sa partenaire et bien le cacher ?",
  "Qui pourrait sortir avec quelqu‚Äôun uniquement pour l‚Äôargent ?",
  "Qui a probablement d√©j√† fantasm√© sur un prof / coll√®gue / ami(e) ?",
  "Qui pense encore √† une vieille histoire d‚Äôamour qu‚Äôil/elle n‚Äôa jamais dig√©r√©e ?",
  "Qui passerait √† la t√©l√© pour un scandale ?",
  "Qui a d√©j√† menti sur sa virginit√© ?",
  "Qui simulerait un orgasme pour que √ßa se termine plus vite ?",
  "Qui est le/la plus malhonn√™te ici dans une dispute ?",
  "Qui poste des trucs en mode 'deep' pour attirer l‚Äôattention ?",
  "Qui est le plus susceptible d‚Äô√™tre ghost√© apr√®s un date ?",
  "Qui se remettrait en couple avec un(e) ex s‚Äôil/elle revenait maintenant ?",
  "Qui est du genre √† r√©pondre 'ok' quand il/elle est v√©n√®re ?",
  "Qui cache le plus de choses sur sa vraie personnalit√© ?",
  "Qui est s√ªrement d√©j√† sorti(e) avec quelqu‚Äôun juste pour le physique ?",
  "Qui a s√ªrement d√©j√† flirt√© avec un(e) pote en couple ?",
  "Qui a la libido la plus √©lev√©e ici ?",
  "Qui pourrait tout plaquer du jour au lendemain ?",
  "Qui a d√©j√† utilis√© un faux nom ou mensonge sur une app de rencontre ?",
  "Qui est le plus probable d‚Äôavoir fait une sextape ?",
  "Qui est d√©j√† sorti(e) avec quelqu‚Äôun juste pour rendre jaloux(se) un(e) ex ?",
  "Qui est toujours dans le d√©ni de ses sentiments ?",
  "Qui est probablement d√©j√† all√©(e) tr√®s loin dans les DM d‚Äôun(e) inconnu(e) ?",
  "Qui a d√©j√† eu honte de ses parents en public ?",
  "Qui est s√ªrement d√©j√† sorti(e) avec quelqu‚Äôun en pensant √† un(e) autre ?",
  "Qui a d√©j√† √©t√© largu√©(e) par message et l‚Äôa mal v√©cu ?",
  "Qui est le/la plus √† m√™me d‚Äôavoir des go√ªts bizarres au lit ?",
  "Qui a d√©j√† menti √† propos d‚Äôun(e) ami(e) ici ?",
  "Qui pourrait √©crire un livre entier sur ses dramas amoureux ?",
  "Qui a le plus de chances d‚Äôavoir un kink chelou ?",

  // ‚Äî QUESTIONS TRASH üî• (tr√®s sensibles, √† jouer avec des gens avertis) ‚Äî
  "Qui ici m√©riterait le plus de mourir en premier dans un film d‚Äôhorreur ?",
  "Qui ici serait le plus susceptible d'√™tre abandonn√© par tout le monde sans que personne ne s‚Äôen rende compte ?",
  "Qui est clairement l√† par piti√© ce soir ?",
  "Qui ici serait le parent le plus toxique ?",
  "Si on devait sacrifier quelqu‚Äôun autour de la table, qui serait choisi ?",
  "Qui serait le moins pleur√© s‚Äôil/elle mourait demain ?",
  "Qui a le moins de chances de r√©ussir sa vie ?",
  "Qui finira seul(e) avec des chats et aucun h√©ritage ?",
  "Qui serait le plus √† m√™me de tout g√¢cher dans un moment important (genre mariage, accouchement, enterrement...) ?",
  "Qui a la vibe 'j‚Äôai un corps dans mon cong√©lateur' ?",
  "Qui ici a probablement d√©j√† fait pleurer quelqu‚Äôun juste pour tester son pouvoir ?",
  "Qui n‚Äôa aucun charisme mais ne l‚Äôa pas encore compris ?",
  "Qui ferait le/la pire coloc possible ?",
  "Qui finirait dans une secte sans s‚Äôen rendre compte ?",
  "Qui serait capable de ruiner une vie par simple jalousie ?"
];

    // Helpers (affichage robuste)
    const $ = id => document.getElementById(id);
    function show(id){ const el=$(id); el.classList.remove("hidden"); el.style.display=""; }
    function hide(id){ const el=$(id); el.classList.add("hidden"); el.style.display="none"; }

    function renderQuestionOptions(){
      const sel = $("questionSelect");
      sel.innerHTML = "";
      const placeholder = document.createElement("option");
      placeholder.value = "";
      placeholder.textContent = "‚Äî Choisis une question pr√©d√©finie ‚Äî";
      sel.appendChild(placeholder);

      availableQuestions.forEach(q => {
        const opt = document.createElement("option");
        opt.value = q; opt.textContent = q;
        sel.appendChild(opt);
      });

      sel.disabled = availableQuestions.length === 0;
      if(availableQuestions.length === 0){
        sel.innerHTML = "";
        const opt = document.createElement("option");
        opt.value = "";
        opt.textContent = "‚Äî Plus de questions pr√©d√©finies (√©cris la tienne) ‚Äî";
        sel.appendChild(opt);
        sel.disabled = true;
      }
    }

    function addPlayerInput(){
      const c = $("playersContainer");
      const inp = document.createElement("input");
      inp.className = "input player-input";
      inp.type = "text";
      inp.placeholder = "Pr√©nom du joueur";
      c.appendChild(inp);
    }

    function startGame(){
      const inputs = Array.from(document.querySelectorAll(".player-input"));
      players = inputs.map(i => i.value.trim()).filter(v => v);
      if(players.length < 3){
        alert("Il faut au moins 3 joueurs pour ce mode.");
        return;
      }
      hide("menu");
      chooseStarter();
    }

    function chooseStarter(name=null){
      starter = name || players[Math.floor(Math.random()*players.length)];
      $("starterInfo").textContent = `üéâ ${starter} commence ! Choisis une question :`;
      $("customQuestion").value = "";
      renderQuestionOptions();
      hide("passToViewer");
      show("questionChoice");   // dropdown + champ visibles
      show("starterPhase");
    }

    // === STARTER CHOISIT LA QUESTION ===
    function validateQuestion(){
      const predef = $("questionSelect").value;
      const custom = $("customQuestion").value.trim();
      if(!predef && !custom){
        alert("Choisis une question ou √©cris-en une.");
        return;
      }
      currentQuestion = custom || predef;

      // Retire la question s√©lectionn√©e (si pr√©d√©finie)
      if(predef){
        const idx = availableQuestions.indexOf(predef);
        if(idx >= 0) availableQuestions.splice(idx,1);
      }

      // Masque le dropdown + champ libre sur CET √©cran, et affiche le message
      hide("questionChoice");
      show("passToViewer");
    }

    function viewerReceived(){
      // Le lecteur voit la question et choisit la cible via boutons
      hide("starterPhase");
      $("questionForViewer").textContent = currentQuestion;

      const cont = $("targetButtons");
      cont.innerHTML = "";
      selectedTarget = null;

      players.forEach(p => {
        const b = document.createElement("button");
        b.className = "btn btn-outline";
        b.textContent = p;
        b.onclick = () => {
          document.querySelectorAll("#targetButtons button").forEach(btn=>btn.classList.remove("selected"));
          b.classList.add("selected");     // bordure verte
          selectedTarget = p;
          show("validateTargetBtn");
        };
        cont.appendChild(b);
      });

      hide("validateTargetBtn");
      show("viewerStage");
    }

    // Valide le joueur cible apr√®s s√©lection (bordure verte)
    function confirmTarget(){
      if(!selectedTarget){ alert("S√©lectionne un joueur cible."); return; }
      target = selectedTarget;
      hide("viewerStage");
      $("passMsg").textContent = `üëâ Passe le t√©l√©phone √† ${target}.`;
      show("passToTarget");
    }

    function targetReceived(){
      hide("passToTarget");
      $("coinHeader").textContent = `C'est √† ${target} de lancer la pi√®ce`;
      $("coinInfo").textContent = "Appuie pour lancer la pi√®ce.";
      $("questionForTarget").classList.add("hidden");
      $("qTextTarget").textContent = "";
      hide("afterFlip");
      $("celebrationText").classList.add("hidden");
      $("revealBtn").classList.add("hidden");
      $("nextBtn").classList.add("hidden");
      $("flipBtn").disabled = false;
      show("coinPhase");
      show("flipBtn");

      // R√©initialise visuellement la pi√®ce √† son angle courant sans transition
      coinRotation = ((coinRotation % 360) + 360) % 360;
      const coin = $("coin");
      coin.style.transition = "none";
      coin.style.transform = `rotateY(${coinRotation}deg)`;
    }

    // Confettis (non bloquants)
    function launchConfetti(){
      const colors = ["#ff4757","#1e90ff","#2ed573","#ffa502","#ff6b81","#5352ed","#70a1ff","#7bed9f","#eccc68"];
      const pieces = 100;
      for(let i=0;i<pieces;i++){
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random()*100 + "vw";
        c.style.background = colors[Math.floor(Math.random()*colors.length)];
        const dur = 1.6 + Math.random()*1.2;
        const delay = Math.random()*0.25;
        c.style.animationDuration = dur + "s";
        c.style.animationDelay = delay + "s";
        c.style.width = (8 + Math.random()*6) + "px";
        c.style.height = (10 + Math.random()*10) + "px";
        document.body.appendChild(c);
        setTimeout(()=>c.remove(), (dur+delay+0.2)*1000);
      }
      if(navigator.vibrate){ try{ navigator.vibrate(80); }catch(e){} }
    }

    // Lancer la pi√®ce (50/50) ‚Äî arr√™t naturel sur la bonne face
    function flipCoin(){
      const coin = $("coin");
      const flipBtn = $("flipBtn");

      // Toujours masquer/d√©sactiver "Voir la question" au d√©part et cacher "Suivante"
      $("revealBtn").classList.add("hidden");
      $("revealBtn").disabled = true;
      $("nextBtn").classList.add("hidden");

      flipBtn.disabled = true;
      hide("flipBtn");
      $("coinInfo").textContent = "üí´ La pi√®ce tourne...";

      // 50/50
      lastFlipWasPile = Math.random() < 0.5;

      // Angle actuel normalis√© et angle cible (0 = PILE, 180 = FACE)
      const current = ((coinRotation % 360) + 360) % 360;
      const desired = lastFlipWasPile ? 0 : 180;
      const delta = (desired - current + 360) % 360;

      // Plusieurs tours + delta vers la bonne face
      const extraSpins = 4 + Math.floor(Math.random()*3);  // 4..6 tours
      const finalAngle = coinRotation + extraSpins*360 + delta;

      coin.style.transition = "transform 1.6s cubic-bezier(.3,.01,.2,1)";
      coin.offsetHeight;
      coin.style.transform = `rotateY(${finalAngle}deg)`;

      const onEnd = () => {
        coin.removeEventListener("transitionend", onEnd);
        show("afterFlip");

        if (lastFlipWasPile) {
          // ‚úÖ PILE : on peut r√©v√©ler
          $("celebrationText").classList.remove("hidden");
          $("revealBtn").classList.remove("hidden");
          $("revealBtn").disabled = false;
          $("coinInfo").textContent = `üéâ PILE ! ${target} peut voir la question.`;
          launchConfetti();
          $("revealBtn").scrollIntoView({behavior:"smooth", block:"center"});
        } else {
          // ‚ùå FACE : ne jamais montrer "Voir la question"
          $("celebrationText").classList.add("hidden");
          $("revealBtn").classList.add("hidden");
          $("revealBtn").disabled = true;
          $("coinInfo").textContent = "‚ö™ FACE ‚Äî la question reste cach√©e.";
          $("nextBtn").classList.remove("hidden");
          $("nextBtn").scrollIntoView({behavior:"smooth", block:"center"});
        }

        // M√©morise l‚Äôorientation finale
        coinRotation = finalAngle % 360;
      };
      coin.addEventListener("transitionend", onEnd, { once:true });
    }

    function revealToTarget(){
      if(!lastFlipWasPile) return; // s√©curit√©
      $("qTextTarget").textContent = currentQuestion;
      $("questionForTarget").classList.remove("hidden");
      $("revealBtn").classList.add("hidden");
      $("nextBtn").classList.remove("hidden");
      $("nextBtn").scrollIntoView({behavior:"smooth", block:"center"});
    }

    // Nouveau tour : le nouveau starter = le joueur qui vient de lancer la pi√®ce
    function nextRound(){
      hide("coinPhase");
      chooseStarter(target);
    }
  </script>
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("‚úÖ Service Worker enregistr√©"))
      .catch((err) => console.error("‚ùå Erreur SW:", err));
  }
</script>
</body>
</html>

